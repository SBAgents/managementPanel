<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ | –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <style>
        :root {
            --primary-bg: linear-gradient(135deg, #042F28 0%, #0A5C4A 100%);
            --accent: #D0E41E;
            --text: white;
            --card-bg: rgba(255, 255, 255, 0.1);
            --input-bg: rgba(255, 255, 255, 0.9);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { 
            background: var(--primary-bg); 
            color: var(--text); 
            min-height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
            position: relative;
        }
        
        /* Language selector */
        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        .language-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        .language-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 8px;
            margin-top: 5px;
            min-width: 150px;
            display: none;
            overflow: hidden;
        }
        .language-dropdown.show {
            display: block;
        }
        .language-option {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .language-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .language-flag {
            width: 24px;
            height: 16px;
            object-fit: cover;
            border-radius: 2px;
        }
        
        /* Login box */
        .login-box { 
            background: var(--card-bg); 
            border-radius: 15px; 
            padding: 40px; 
            width: 100%; 
            max-width: 400px; 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            backdrop-filter: blur(10px); 
            text-align: center; 
        }
        .logo { font-size: 28px; font-weight: bold; color: var(--accent); margin-bottom: 10px; }
        .input-group { margin: 20px 0; text-align: left; position: relative; }
        label { display: block; margin-bottom: 8px; color: var(--accent); font-weight: bold; }
        input { 
            width: 100%; 
            padding: 12px 15px; 
            padding-right: 45px;
            background: var(--input-bg); 
            border: 2px solid #34495e; 
            border-radius: 8px; 
            color: #2c3e50; 
            font-size: 16px; 
            transition: border 0.3s;
            /* Disable autofill */
            autocomplete: "new-password";
            -webkit-autocomplete: "new-password";
        }
        input:-webkit-autofill {
            -webkit-box-shadow: 0 0 0 1000px var(--input-bg) inset !important;
            -webkit-text-fill-color: #2c3e50 !important;
        }
        input:focus { 
            outline: none; 
            border-color: var(--accent); 
            background: white; 
        }
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 40px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            transition: color 0.3s;
        }
        .password-toggle svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }
        .password-toggle:hover { color: #34495e; }
        .checkbox-group {
            display: flex;
            align-items: center;
            margin: 15px 0 25px;
            gap: 10px;
        }
        .checkbox-group input[type="checkbox"] {
            width: auto;
            transform: scale(1.2);
        }
        .checkbox-group label {
            margin: 0;
            font-weight: normal;
            color: var(--text);
            cursor: pointer;
        }
        button { 
            width: 100%; 
            padding: 15px; 
            background: var(--accent); 
            color: #2c3e50; 
            border: none; 
            border-radius: 8px; 
            font-size: 16px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.3s; 
        }
        button:hover { background: #b8cc1a; transform: translateY(-2px); }
        button:disabled { 
            background: #7f8c8d; 
            cursor: not-allowed; 
            transform: none; 
        }
        .error { 
            background: rgba(231, 76, 60, 0.15); 
            border: 1px solid #e74c3c; 
            border-radius: 8px; 
            padding: 12px; 
            margin: 15px 0; 
            color: #e74c3c; 
            display: none; 
            text-align: left;
        }
        .error.show { display: block; }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
            vertical-align: middle;
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        @media (max-width: 480px) { 
            .login-box { padding: 30px 20px; } 
            .language-selector { top: 10px; right: 10px; }
        }
        
        /* RTL support for Arabic */
        body[dir="rtl"] .input-group {
            text-align: right;
        }
        body[dir="rtl"] .password-toggle {
            right: auto;
            left: 15px;
        }
        body[dir="rtl"] input {
            padding: 12px 15px;
            padding-left: 45px;
            padding-right: 15px;
        }
        body[dir="rtl"] .language-selector {
            right: auto;
            left: 20px;
        }
        @media (max-width: 480px) {
            body[dir="rtl"] .language-selector {
                left: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div class="language-selector">
        <div class="language-btn" id="languageBtn">
            <span id="currentLanguage">üåê RU</span>
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                <path d="M2 4L6 8L10 4" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        <div class="language-dropdown" id="languageDropdown">
            <div class="language-option" data-lang="ru">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjE2IiBmaWxsPSJ3aGl0ZSIvPgo8cmVjdCB5PSI1IiB3aWR0aD0iMjQiIGhlaWdodD0iNiIgZmlsbD0iI0Q1MjgzNCIvPgo8cmVjdCB5PSIxMCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjYiIGZpbGw9IiMwMDlDOTkiLz4KPC9zdmc+" alt="RU" class="language-flag">
                –†—É—Å—Å–∫–∏–π
            </div>
            <div class="language-option" data-lang="en">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjE2IiBmaWxsPSIjMDEyMTY5Ii8+CjxwYXRoIGQ9Ik0wIDBMMjQgMEwyNCAyTDIgMkwyIDZMMjQgNkwyNCA4TDIgOEwyIDE0TDI0IDE0TDI0IDE2TDAgMTZaTTAgMEwwIDE2TDAgMFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0wIDBMMjQgMEwyNCAxTDIgMUwyIDVMMjQgNUwyNCA3TDIgN0wyIDEzTDI0IDEzTDI0IDE1TDAgMTVaTTAgMEwwIDE1TDAgMFoiIGZpbGw9IiNFNDAyMzMiLz4KPC9zdmc+" alt="EN" class="language-flag">
                English
            </div>
            <div class="language-option" data-lang="fr">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMTYiIHdpZHRoPSI4IiBoZWlnaHQ9IjE2IiBmaWxsPSIjRjUxRTIyIi8+CjxyZWN0IHg9IjgiIHdpZHRoPSI4IiBoZWlnaHQ9IjE2IiBmaWxsPSJ3aGl0ZSIvPgo8cmVjdCB3aWR0aD0iOCIgaGVpZ2h0PSIxNiIgZmlsbD0iIzAwMjY1MyIvPgo8L3N2Zz4=" alt="FR" class="language-flag">
                Fran√ßais
            </div>
            <div class="language-option" data-lang="ar">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjE2IiBmaWxsPSIjQ0VBMjMxIi8+CjxwYXRoIGQ9Ik0wIDBIMjRWMUgweiIgZmlsbD0iI0U3MDM0NCIvPgo8cGF0aCBkPSJNMCAxNUgyNFYxNkgyNlYxNUgweiIgZmlsbD0iIzAwNzc0MSIvPgo8cGF0aCBkPSJNNS44IDkuMjFMMy42NiA4LjM5IDQuMDggNi4yOSA2LjIgNy4xMiA4LjMzIDYuMjkgOC43NSA4LjM5IDYuNjQgOS4yMSA4Ljc3IDEwLjA0IDguMzUgMTIuMTQgNi4yIDExLjMgNC4wOCAxMi4xNCAzLjY2IDEwLjA0IDUuOCA5LjIxWiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+" alt="AR" class="language-flag">
                ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
            </div>
        </div>
    </div>
    
    <div class="login-box">
        <div class="logo" data-i18n="title">üîê –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
        <p data-i18n="subtitle">–ü–ª–∞—Ç—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</p>
        
        <div class="error" id="errorMsg"></div>
        
        <div class="input-group">
            <label for="username" data-i18n="username">–õ–æ–≥–∏–Ω</label>
            <input type="text" id="username" data-i18n-placeholder="username_placeholder" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" autocomplete="off">
        </div>
        
        <div class="input-group">
            <label for="password" data-i18n="password">–ü–∞—Ä–æ–ª—å</label>
            <input type="password" id="password" data-i18n-placeholder="password_placeholder" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="new-password">
            <button type="button" class="password-toggle" id="togglePassword">
                <svg viewBox="0 0 24 24">
                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                </svg>
            </button>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="rememberMe">
            <label for="rememberMe" data-i18n="remember_me">–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è</label>
        </div>
        
        <button onclick="login()" id="loginBtn" data-i18n="login_button">–í–æ–π—Ç–∏</button>
    </div>

    <script>
        // Translation dictionary
        const translations = {
            ru: {
                title: "üîê –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
                subtitle: "–ü–ª–∞—Ç—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞",
                username: "–õ–æ–≥–∏–Ω",
                username_placeholder: "–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω",
                password: "–ü–∞—Ä–æ–ª—å",
                password_placeholder: "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å",
                remember_me: "–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è",
                login_button: "–í–æ–π—Ç–∏",
                error_required: "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è",
                error_connection: "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É",
                error_invalid: "–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å",
                logging_in: "–í—Ö–æ–¥..."
            },
            en: {
                title: "üîê Control Panel",
                subtitle: "Payment System",
                username: "Username",
                username_placeholder: "Enter username",
                password: "Password",
                password_placeholder: "Enter password",
                remember_me: "Remember me",
                login_button: "Log In",
                error_required: "Please fill in all fields",
                error_connection: "Server connection error",
                error_invalid: "Invalid username or password",
                logging_in: "Logging in..."
            },
            fr: {
                title: "üîê Panneau de contr√¥le",
                subtitle: "Syst√®me de paiement",
                username: "Nom d'utilisateur",
                username_placeholder: "Entrez le nom d'utilisateur",
                password: "Mot de passe",
                password_placeholder: "Entrez le mot de passe",
                remember_me: "Se souvenir de moi",
                login_button: "Se connecter",
                error_required: "Veuillez remplir tous les champs",
                error_connection: "Erreur de connexion au serveur",
                error_invalid: "Nom d'utilisateur ou mot de passe incorrect",
                logging_in: "Connexion en cours..."
            },
            ar: {
                title: "üîê ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ",
                subtitle: "ŸÜÿ∏ÿßŸÖ ÿßŸÑÿØŸÅÿπ",
                username: "ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ",
                username_placeholder: "ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ",
                password: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",
                password_placeholder: "ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",
                remember_me: "ÿ™ÿ∞ŸÉÿ±ŸÜŸä",
                login_button: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
                error_required: "Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ",
                error_connection: "ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ",
                error_invalid: "ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ£Ÿà ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©",
                logging_in: "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ..."
            }
        };

        // Current language
        let currentLanguage = 'ru';

        // Browser language detection
        function detectBrowserLanguage() {
            const browserLang = navigator.language || navigator.userLanguage;
            const lang = browserLang.split('-')[0].toLowerCase();
            
            if (['ru', 'en', 'fr', 'ar'].includes(lang)) {
                return lang;
            }
            return 'en'; // default to English
        }

        // Apply translation
        function applyTranslation(lang) {
            const dict = translations[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (dict[key]) el.textContent = dict[key];
            });
            
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (dict[key]) el.setAttribute('placeholder', dict[key]);
            });
            
            document.getElementById('currentLanguage').textContent = 
                lang === 'ru' ? 'üåê RU' : 
                lang === 'en' ? 'üåê EN' : 
                lang === 'fr' ? 'üåê FR' : 'üåê AR';
            
            // Set RTL for Arabic
            if (lang === 'ar') {
                document.body.setAttribute('dir', 'rtl');
            } else {
                document.body.removeAttribute('dir');
            }
            
            currentLanguage = lang;
            localStorage.setItem('preferred_language', lang);
        }

        // Language selector functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize language
            const savedLang = localStorage.getItem('preferred_language');
            const detectedLang = savedLang || detectBrowserLanguage();
            applyTranslation(detectedLang);
            
            // Language selector dropdown
            const languageBtn = document.getElementById('languageBtn');
            const languageDropdown = document.getElementById('languageDropdown');
            
            languageBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                languageDropdown.classList.toggle('show');
            });
            
            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    applyTranslation(lang);
                    languageDropdown.classList.remove('show');
                });
            });
            
            document.addEventListener('click', function() {
                languageDropdown.classList.remove('show');
            });
            
            // Remove saved login data on page load
            localStorage.removeItem('saved_login');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('rememberMe').checked = false;
            
            // Password toggle with new icon
            const toggleBtn = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('password');
            
            toggleBtn.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                // Update icon
                const svg = this.querySelector('svg');
                if (type === 'password') {
                    svg.innerHTML = '<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>';
                } else {
                    svg.innerHTML = '<path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>';
                }
            });
            
            // Enter key login
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
        });
        
        async function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const rememberMe = document.getElementById('rememberMe').checked;
            const btn = document.getElementById('loginBtn');
            const error = document.getElementById('errorMsg');
            
            // Validation
            if (!username || !password) {
                showError(translations[currentLanguage].error_required);
                return;
            }
            
            // Disable button and show loading
            btn.disabled = true;
            const originalText = btn.textContent;
            btn.innerHTML = '<div class="loader"></div> ' + translations[currentLanguage].logging_in;
            error.classList.remove('show');
            
            try {
                // ‚ö†Ô∏è –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® –†–ï–ê–õ–¨–ù–´–ô URL
                const API_URL = 'https://script.google.com/macros/s/AKfycbxDaBdYMx44M2W3FsJp5tOECFTRD6rWrhPAC96MuUexROt5Qjgj4U0er4So6Ehsh8xQ5g/exec';
                const url = `${API_URL}?action=login&username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`;
                
                console.log('Login request to:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const result = await response.json();
                
                if (result.success && result.token) {
                    // Save token and redirect
                    localStorage.setItem('admin_token', result.token);
                    localStorage.setItem('admin_user', JSON.stringify(result.user));
                    localStorage.setItem('admin_permissions', JSON.stringify(result.permissions));
                    localStorage.setItem('current_language', currentLanguage);
                    localStorage.setItem('session', 'active');
                    localStorage.setItem('sessionExpiry', Date.now() + 10800000); // 3 —á–∞—Å–∞
                    
                    window.location.href = 'wallets.html';
                } else {
                    showError(result.error || translations[currentLanguage].error_invalid);
                    btn.disabled = false;
                    btn.textContent = originalText;
                }
                
            } catch (err) {
                console.error('Login error:', err);
                showError(translations[currentLanguage].error_connection);
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }
        
        function showError(message) {
            const error = document.getElementById('errorMsg');
            error.textContent = message;
            error.classList.add('show');
        }
    </script>
</body>
</html>
